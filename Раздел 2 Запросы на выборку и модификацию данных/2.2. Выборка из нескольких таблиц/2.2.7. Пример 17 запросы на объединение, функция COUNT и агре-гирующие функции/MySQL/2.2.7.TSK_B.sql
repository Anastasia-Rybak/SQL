-- Задание 2.2.7.TSK.B: показать самый читаемый жанр, т.е. жанр (или жанры, если их несколько), относящиеся к которому книги читатели брали чаще всего.
SELECT `g_id`, `g_name`, COUNT(`subscriptions`.`b_id`) AS `books` FROM `genres` JOIN `m2m_books_genres` USING (`g_id`) LEFT OUTER JOIN `subscriptions` ON `m2m_books_genres`.`b_id` = `subscriptions`.`b_id` GROUP BY `genres`.`g_id` HAVING `books` = (SELECT MAX(`books`) FROM (SELECT COUNT(`subscriptions`.`b_id`) AS `books` FROM `genres` JOIN `m2m_books_genres` USING ( `g_id` ) LEFT OUTER JOIN `subscriptions` ON `m2m_books_genres`.`b_id` = `subscriptions`.`b_id` GROUP BY `g_id` ) AS `books_per_author`)