-- Задание 2.2.7.TSK.D: показать медиану читаемости жанров, т.е. медианное значение от того, сколько раз читатели брали книги каждого жанра.
SELECT AVG(`books`) AS `med_reading` FROM (SELECT @rownum := @rownum + 1 AS `RowNumber`, `books` FROM (SELECT COUNT(`subscriptions`.`b_id`) AS `books` FROM `genres` JOIN `m2m_books_genres` USING (`g_id`) LEFT OUTER JOIN `subscriptions` ON `m2m_books_genres`.`b_id` = `subscriptions`.`b_id` GROUP BY `g_id`) AS `inner_data`, (SELECT @rownum := 0) AS `rownum_initialisation` ORDER BY `books`) AS `popularity`, (SELECT COUNT(*) AS `RowCount` FROM (SELECT COUNT(`subscriptions`.`b_id`) AS `books` FROM `genres` JOIN `m2m_books_genres` USING (`g_id`) LEFT OUTER JOIN `subscriptions` ON `m2m_books_genres`.`b_id` = `subscriptions`.`b_id` GROUP BY `g_id`) AS `inner_data`) AS `total_rows` WHERE `RowNumber` IN ( FLOOR(( `RowCount` + 1 ) / 2), FLOOR(( `RowCount` + 2 ) / 2) )