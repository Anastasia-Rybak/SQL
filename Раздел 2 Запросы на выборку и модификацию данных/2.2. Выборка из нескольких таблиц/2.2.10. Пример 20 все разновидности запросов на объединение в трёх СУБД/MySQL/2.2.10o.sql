-- Задача 2.2.10.o: показать расстановку компьютеров по всем комнатам так, чтобы в выборку не попало больше компьютеров, чем может поме-ститься в комнату.
SELECT `r_id`, `r_name`, `r_space`, `c_id`, `c_room`, `c_name` FROM `rooms` LEFT JOIN (SELECT `c_id`, `c_room`, `c_name`, @row_num := IF(@prev_value = `c_room`, @row_num + 1, 1) AS `position`, @prev_value := `c_room` FROM `computers`, (SELECT @row_num := 1) AS `x`, (SELECT @prev_value := '') AS `y` ORDER BY `c_room`, `c_name` ASC) AS `cross_apply_data` ON `r_id` = `c_room` WHERE `position` <= `r_space` OR `position` IS NULL ORDER BY `r_id`, `c_id`