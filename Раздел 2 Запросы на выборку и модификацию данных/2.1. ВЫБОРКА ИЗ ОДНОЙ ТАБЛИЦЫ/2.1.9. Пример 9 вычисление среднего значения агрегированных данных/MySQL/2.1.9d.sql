-- Задача 2.1.9.d{57}: показать, сколько в среднем дней читатели читают книгу (учесть оба случая — и когда книга была возвращена, и когда книга не была возвращена).
SELECT AVG(`diff`) AS `avg_days` FROM ( SELECT DATEDIFF(`sb_finish`, `sb_start`) AS `diff` FROM `subscriptions` WHERE ( `sb_finish` <= CURDATE() AND `sb_is_active` = 'N' ) OR ( `sb_finish` > CURDATE() AND `sb_is_active` = 'Y' ) UNION ALL SELECT DATEDIFF(CURDATE(), `sb_start`) AS `diff` FROM `subscriptions` WHERE ( `sb_finish` <= CURDATE() AND `sb_is_active` = 'Y' ) OR ( `sb_finish` > CURDATE() AND `sb_is_active` = 'N' ) ) AS `diffs`